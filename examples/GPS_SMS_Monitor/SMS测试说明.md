# SMS中文测试程序使用说明

## 程序概述

这是一个专为**中国电信**SIM卡设计的SMS中文短信测试程序。程序会每隔60秒发送一次中文测试短信，连续发送3次后自动停止。

## 关键配置

### 1. 电信短信中心号码
```cpp
#define SMS_CENTER "+8618950000321"  // 中国电信 - 福建
```

根据你的图片，已配置为福建电信的短信中心号码：`+8618950000321`

### 2. 目标手机号
```cpp
#define SMS_TARGET  "+8615821259813"
```

### 3. 发送设置
- **发送间隔**: 60秒（1分钟）
- **发送次数**: 3次
- **中文编码**: PDU模式（自动处理中文）

## 相关文件

### 主程序文件
1. **`examples/GPS_SMS_Monitor/GPS_SMS_Monitor.ino`** - 主程序（已修改）
   - 去除了GPS功能依赖
   - 配置电信短信中心号码
   - 实现中文短信发送
   - 每分钟发送一次，共3次

2. **`examples/GPS_SMS_Monitor/utilities.h`** - 板级配置文件
   - 定义了T-Call-A7670X-V1-0的引脚配置
   - 调制解调器类型定义

### 配置文件
3. **`platformio.ini`** - 项目构建配置
   - 当前选择的板型: `T-Call-A7670X-V1-0`
   - 当前选择的例程: `examples/GPS_SMS_Monitor`

## 程序功能特性

### ✅ 已实现功能
1. **电信短信中心配置** - AT+CSCA设置为"+8618950000321"
2. **中文编码支持** - 使用PDU模式，TinyGSM自动处理中文编码
3. **定时发送** - 每60秒发送一次
4. **次数限制** - 发送3次后自动停止
5. **详细日志** - 完整的调试信息输出

### 📋 测试消息格式
```
这是第X次测试短信。系统时间：XXX秒。中文编码测试成功！
```

## 使用步骤

### 1. 硬件准备
- LilyGo T-Call A7670X V1.0 开发板
- 中国电信SIM卡（已禁用PIN码）
- 5V 2A 外部电源（重要！USB供电可能不足）
- GSM天线

### 2. 编译上传
```bash
# 编译
pio run -e T-Call-A7670X-V1-0

# 上传
pio run -t upload -e T-Call-A7670X-V1-0

# 监视串口输出
pio device monitor --port /dev/cu.usbserial-59691448411 --baud 115200
```

### 3. 运行流程
程序启动后会依次执行：
1. 初始化调制解调器
2. 设置短信中心号码（+8618950000321）
3. 等待网络注册
4. 每60秒发送一次测试短信
5. 发送3次后停止

### 4. 监控输出
串口会显示详细信息：
- 调制解调器状态
- 短信中心配置结果
- 网络注册状态
- 信号质量
- 每次发送的状态（成功/失败）

## 预期输出示例

```
====================================
SMS中文测试程序 - 电信卡专用
====================================
正在启动调制解调器...
✅ 调制解调器已就绪
正在配置SMS...
设置短信中心号码: +8618950000321
✅ 短信中心号码设置成功: +8618950000321
✅ 短信中心号码验证成功
✅ SMS已配置（支持中文PDU编码）
等待网络注册...
✅ 网络注册成功
信号质量: 25 (0-31, 越高越好)

✅ 系统已就绪
将每60秒发送一次中文测试短信，共发送3次
目标号码: +8615821259813
短信中心: +8618950000321

========================================
准备发送第 1/3 条短信
========================================
消息内容：
这是第1次测试短信。系统时间：15秒。中文编码测试成功！

正在发送短信到 +8615821259813...
✅ 短信发送成功！
========================================
下次发送时间：60秒后 (剩余 2 次)
```

## 故障排查

### 如果短信发送失败
1. **检查信号质量** - 应该 >10，最好 >15
2. **验证短信中心号码** - 确认 `+8618950000321` 是否正确
3. **检查SIM卡余额** - 确保有足够余额
4. **检查网络注册** - 必须显示"网络注册成功"
5. **更换短信中心号码** - 可能需要根据地区调整

### 常见电信短信中心号码
- 福建: +8618950000321 ✅（当前配置）
- 上海: +8613800210500
- 广东: +8613800200500
- 北京: +8613800100500

## 关键代码说明

### 短信中心配置
```cpp
modem.sendAT("+CSCA=\"+8618950000321\"");
```

### 中文消息发送
```cpp
String message = "这是第" + String(count) + "次测试短信。";
bool success = modem.sendSMS(SMS_TARGET, message);
```

TinyGSM库会自动：
1. 将中文字符串转换为PDU格式
2. 使用UCS2编码处理中文
3. 发送完整的PDU数据包

## 注意事项

⚠️ **重要提醒**:
1. 必须使用外部5V 2A电源，USB供电可能导致调制解调器启动失败
2. SIM卡必须禁用PIN码保护
3. 确保GSM天线连接良好
4. 首次运行可能需要几秒钟完成网络注册
5. 电信卡在某些地区可能需要不同的短信中心号码

## 下一步计划

测试SMS功能成功后，可以：
1. 添加GPS功能，发送带定位信息的短信
2. 实现接收短信功能，远程控制设备
3. 添加触发条件（如按键触发发送）
4. 优化电源管理，降低功耗
